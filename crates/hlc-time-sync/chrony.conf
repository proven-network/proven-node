# Chrony configuration for Proven enclave
# This config prioritizes AWS Time Sync for low latency while using
# Cloudflare NTS for cryptographic validation

# AWS Time Sync - preferred for microsecond precision
# Link-local IP (works within EC2/Nitro, lowest latency)
# 'prefer' means Chrony will select this unless it's unreachable/unstable
# minpoll 4 = 2^4 = 16 seconds, maxpoll 6 = 2^6 = 64 seconds
server 169.254.169.123 iburst prefer minpoll 4 maxpoll 6

# AWS Time Sync - public endpoint (failover if link-local unavailable)
# Works from anywhere, slightly higher latency than link-local
server time.aws.com iburst minpoll 4 maxpoll 6

# Cloudflare NTS - for validation only, never selected as reference
# 'noselect' means monitor for statistics but never sync to it
server time.cloudflare.com iburst nts noselect minpoll 4 maxpoll 6

# Allow stepping the clock for the first 3 updates if offset > 1 second
makestep 1.0 3

# Record drift to adjust clock on restart
driftfile /var/lib/chrony/drift

# Log tracking, measurements, and statistics
logdir /var/log/chrony
log tracking measurements statistics

# Real-time clock (if available in enclave)
rtcsync

# Command port for chrony-candm queries (default is 323)
cmdport 323

# Unix domain socket for local queries (required for chrony-candm)
bindcmdaddress /var/run/chrony/chronyd.sock

# Also bind to localhost for chronyc
bindcmdaddress 127.0.0.1
bindcmdaddress ::1

# Allow local connections
cmdallow 127.0.0.1
cmdallow ::1
